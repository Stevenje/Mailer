// Generated by CoffeeScript 1.7.1
var BSON, Db, Server, client, db, gitdata, lang, location, mongo, page, request, server;

mongo = require("mongodb");

Server = mongo.Server;

Db = mongo.Db;

BSON = mongo.BSONPure;

server = new Server("localhost", 27017, {
  auto_reconnect: true
});

db = new Db("githubdb", server);

db.open(function(err, db) {
  if (!err) {
    return console.log("Connected to 'githubdb' database");
  }
});

request = require('request-json');

client = request.newClient('https://api.github.com/');

lang = 'ruby';

location = 'london';

page = 1;

gitdata = function(lang, location, page) {
  return client.get('search/users?q=location:' + location + '+language:' + lang + '&page=' + page, function(err, res, body) {
    var profile, profilearray, _i, _len;
    console.log('Total Users found: ' + body.total_count);
    profilearray = body.items;
    console.log(profilearray);
    for (_i = 0, _len = profilearray.length; _i < _len; _i++) {
      profile = profilearray[_i];
      db.collection("profiles", function(err, collection) {
        return collection.insert(profile, {
          safe: true
        }, function(err, result) {});
      });
    }
    return console.log(profile);
  });
};

gitdata(lang, location, page);
